<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    <link rel="canonical" href="http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/">
    
    
    <title>berkeley db 7.x 压力测试报告 | 希尔的博客 | 兰之猗猗，扬扬其香。不采而佩，于兰何伤？</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="jvm:gc,linux:other,linux:perf">
    <meta name="description" content="之前写过一篇文章 apache benchmark 使用笔记, 介绍了 apache benchmark 的使用及注意事项, 当时我确实是使用 ab 作了一个系统的压力测试; 可惜不够重视, 我在博客里只作了关于 ab 的使用笔记, 却没有将当时压测的结果输出为一份详细报告;这次被我逮到机会了: 最近我在调研一个 KV 数据库 oracle berkeley db, 需要测试其新版本 (7.4.">
<meta name="keywords" content="jvm:gc,linux:other,linux:perf">
<meta property="og:type" content="article">
<meta property="og:title" content="berkeley db 7.x 压力测试报告">
<meta property="og:url" content="http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/index.html">
<meta property="og:site_name" content="希尔的博客">
<meta property="og:description" content="之前写过一篇文章 apache benchmark 使用笔记, 介绍了 apache benchmark 的使用及注意事项, 当时我确实是使用 ab 作了一个系统的压力测试; 可惜不够重视, 我在博客里只作了关于 ab 的使用笔记, 却没有将当时压测的结果输出为一份详细报告;这次被我逮到机会了: 最近我在调研一个 KV 数据库 oracle berkeley db, 需要测试其新版本 (7.4.">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-08-09T07:01:58.347Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="berkeley db 7.x 压力测试报告">
<meta name="twitter:description" content="之前写过一篇文章 apache benchmark 使用笔记, 介绍了 apache benchmark 的使用及注意事项, 当时我确实是使用 ab 作了一个系统的压力测试; 可惜不够重视, 我在博客里只作了关于 ab 的使用笔记, 却没有将当时压测的结果输出为一份详细报告;这次被我逮到机会了: 最近我在调研一个 KV 数据库 oracle berkeley db, 需要测试其新版本 (7.4.">
    
        <link rel="alternate" type="application/atom+xml" title="希尔的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <script src="/js/leancloud-revision.js"></script>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="https://avatars0.githubusercontent.com/u/8027247?s=460&v=4" class="avatar waves-effect waves-circle waves-light">
          <img src="https://avatars0.githubusercontent.com/u/8027247?s=460&v=4">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">zshellzhang</h5>
          <a href="mailto:xaaservice@gmail.com" title="xaaservice@gmail.com" class="mail">xaaservice@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zshellzhang1993-2025" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">berkeley db 7.x 压力测试报告</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">berkeley db 7.x 压力测试报告</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-08-12T15:10:04.000Z" itemprop="datePublished" class="page-time">
  2018-08-12
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/linux/">linux</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/linux/other/">other</a></li></ul></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#测试环境"><span class="post-toc-number">1.</span> <span class="post-toc-text">测试环境</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#测试内容"><span class="post-toc-number">2.</span> <span class="post-toc-text">测试内容</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#基础指标分析"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">基础指标分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#jvm-指标分析"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">jvm 指标分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#堆外内存分析"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">堆外内存分析</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#控制变量测试计划"><span class="post-toc-number">3.</span> <span class="post-toc-text">控制变量测试计划</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#计划-A-in-heap-缓存大小控制"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">计划 A: in-heap 缓存大小控制</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#计划-B-off-heap-缓存大小控制"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">计划 B: off-heap 缓存大小控制</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#计划-C-Xmx-Xms-大小控制"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">计划 C: -Xmx / -Xms 大小控制</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#计划-D-bdb-版本对比"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">计划 D: bdb 版本对比</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#计划-E-收集器对比"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">计划 E: 收集器对比</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#测试总结"><span class="post-toc-number">4.</span> <span class="post-toc-text">测试总结</span></a></li></ol>
        </nav>
    </aside>


<article id="post-linux-other--berkeley_db7.x压力测试报告"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">berkeley db 7.x 压力测试报告</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-08-12 23:10:04" datetime="2018-08-12T15:10:04.000Z"  itemprop="datePublished">2018-08-12</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/linux/">linux</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/linux/other/">other</a></li></ul></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>之前写过一篇文章 <a href="http://zshell.cc/2018/01/22/linux-other--apache_benchmark_使用笔记">apache benchmark 使用笔记</a>, 介绍了 apache benchmark 的使用及注意事项, 当时我确实是使用 ab 作了一个系统的压力测试; 可惜不够重视, 我在博客里只作了关于 ab 的使用笔记, 却没有将当时压测的结果输出为一份详细报告;<br>这次被我逮到机会了: 最近我在调研一个 KV 数据库 <code>oracle berkeley db</code>, 需要测试其新版本 (7.4.5) 引入堆外内存作为辅助缓存的实际性能; 我详细得记录了本次压力测试的各种细节 (已经对所有涉及公司内部的信息作了脱敏处理), 希望能以此为模板, 当以后有相关的压力测试需要时, 可以从中获得参考价值;</p>
</blockquote>
<a id="more"></a>
<hr>
<h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a><strong>测试环境</strong></h2><p>测试机器的物理配置如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">24C</span><br><span class="line">64G</span><br><span class="line">2.7T</span><br></pre></td></tr></table></figure></p>
<h2 id="测试内容"><a href="#测试内容" class="headerlink" title="测试内容"></a><strong>测试内容</strong></h2><p>为了构造大量的随机数据以模拟服务的真实场景, mock 了三个接口如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 随机写, key 在 (0, xxx] 范围内随机生成, valueSize 指定 key 的大小</span></span><br><span class="line">http://<span class="variable">$&#123;remote_url&#125;</span>/random_set?keyRange=xxx&amp;valueSize=xxx</span><br><span class="line"><span class="comment"># 随机读, key 在 (0, xxx] 范围内随机生成</span></span><br><span class="line">http://<span class="variable">$&#123;remote_url&#125;</span>/random_get?keyRange=xxx</span><br><span class="line"><span class="comment"># 随机批量读, key 在 (0, xxx] 范围内随机生成, keyNum 指定批量个数</span></span><br><span class="line">http://<span class="variable">$&#123;remote_url&#125;</span>/random_mget?keyRange=xxx&amp;keyNum=yyy</span><br></pre></td></tr></table></figure></p>
<p>在各接口中使用当前时间作为随机数发生的 seed, 确保真实随机, 然后使用 apache benchmark 作压力测试:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次总请求, 250 并发, 5s timeout</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 http://<span class="variable">$&#123;remote_url&#125;</span>/random_get</span><br></pre></td></tr></table></figure></p>
<h3 id="基础指标分析"><a href="#基础指标分析" class="headerlink" title="基础指标分析"></a><strong>基础指标分析</strong></h3><p>使用 ab 收集基础数据:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rt</span></span><br><span class="line">min, mean, median, P90, P99, max</span><br><span class="line"><span class="comment"># 标准差/乖离率</span></span><br><span class="line">stdev</span><br><span class="line"><span class="comment"># failure stat</span></span><br><span class="line">error/exception/timeout</span><br></pre></td></tr></table></figure></p>
<h3 id="jvm-指标分析"><a href="#jvm-指标分析" class="headerlink" title="jvm 指标分析"></a><strong>jvm 指标分析</strong></h3><p>使用 jstat 采样 jvm gc 状态:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># sample</span></span><br><span class="line">S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">5.67   0.00  48.74  70.68  98.24     -  15588  1199.695    20   2.865   1202.561</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 收集关键 gc 状态指标</span></span><br><span class="line">YGC, YGCT, FGC, FGCT</span><br></pre></td></tr></table></figure>
<h3 id="堆外内存分析"><a href="#堆外内存分析" class="headerlink" title="堆外内存分析"></a><strong>堆外内存分析</strong></h3><p>堆外内存无法使用 jmap / jstat 观察, 只能用 top 观察;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top -b -n 100 -H -p <span class="variable">$&#123;vmid&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="控制变量测试计划"><a href="#控制变量测试计划" class="headerlink" title="控制变量测试计划"></a><strong>控制变量测试计划</strong></h2><p>除了计划 E 是专门对比收集器效果的, 其余的测试计划内均使用 ParNew + CMS 的收集器组合, 配置如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-XX:ParallelGCThreads=<span class="variable">$&#123;CPU_COUNT&#125;</span></span><br><span class="line"></span><br><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line">-XX:+UseCMSCompactAtFullCollection</span><br><span class="line">-XX:CMSMaxAbortablePrecleanTime=5000</span><br><span class="line">-XX:+CMSClassUnloadingEnabled</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=80</span><br><span class="line">-XX:+UseCMSInitiatingOccupancyOnly</span><br><span class="line">-XX:+CMSScavengeBeforeRemark</span><br></pre></td></tr></table></figure></p>
<h3 id="计划-A-in-heap-缓存大小控制"><a href="#计划-A-in-heap-缓存大小控制" class="headerlink" title="计划 A: in-heap 缓存大小控制"></a><strong>计划 A: in-heap 缓存大小控制</strong></h3><p>测试环境:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-Xms=25g</span><br><span class="line">-Xmx=25g</span><br><span class="line">-Xmn=10g</span><br><span class="line">-XX:MaxDirectMemorySize=10g</span><br><span class="line">-Dje.maxOffHeapMemory=10g</span><br></pre></td></tr></table></figure></p>
<p><strong>A-1: 测试 set</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_set?keyRange=9999999&amp;valueSize=5000"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/A-1_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ je.maxMemoryPercent</th>
<th style="text-align:center">5%</th>
<th style="text-align:center">10%</th>
<th style="text-align:center">20%</th>
<th style="text-align:center">30%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/122/316/1461</td>
<td style="text-align:center">6/128/352/1708</td>
<td style="text-align:center">6/125/365/3354</td>
<td style="text-align:center">ab timeout</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">85/73</td>
<td style="text-align:center">87/75</td>
<td style="text-align:center">88/75</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">68.2</td>
<td style="text-align:center">72.0</td>
<td style="text-align:center">77.0</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">14/2.998</td>
<td style="text-align:center">14/4.397</td>
<td style="text-align:center">16/6.278</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">2/0.589</td>
<td style="text-align:center">/</td>
</tr>
</tbody>
</table>
</div>
<p><strong>A-2: 测试 get</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_get?keyRange=9999999"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/A-2_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ je.maxMemoryPercent</th>
<th style="text-align:center">5%</th>
<th style="text-align:center">10%</th>
<th style="text-align:center">20%</th>
<th style="text-align:center">30%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">9/32/29/1030</td>
<td style="text-align:center">8/26/29/1038</td>
<td style="text-align:center">8/27/29/1218</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">24/24</td>
<td style="text-align:center">23/24</td>
<td style="text-align:center">22/21</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">2</td>
<td style="text-align:center">2</td>
<td style="text-align:center">5</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">15.8</td>
<td style="text-align:center">17.8</td>
<td style="text-align:center">27.8</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">7/1.442</td>
<td style="text-align:center">6/0.963</td>
<td style="text-align:center">6/0.907</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">/</td>
</tr>
</tbody>
</table>
</div>
<p><strong>A-3: 测试 mget</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_mget?keyRange=9999999&amp;keyNum=20"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/A-3_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ je.maxMemoryPercent</th>
<th style="text-align:center">5%</th>
<th style="text-align:center">10%</th>
<th style="text-align:center">20%</th>
<th style="text-align:center">30%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">8/28/34/4529</td>
<td style="text-align:center">6/28/31/4804</td>
<td style="text-align:center">6/27/33/1073</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">34/26</td>
<td style="text-align:center">32/25</td>
<td style="text-align:center">25/23</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">2006</td>
<td style="text-align:center">10907</td>
<td style="text-align:center">14300</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">139.5</td>
<td style="text-align:center">29.8</td>
<td style="text-align:center">24.3</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">26/31.157</td>
<td style="text-align:center">23/22.947</td>
<td style="text-align:center">24/4.687</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">2/1.689</td>
<td style="text-align:center">1/4.243</td>
<td style="text-align:center">/</td>
</tr>
</tbody>
</table>
</div>
<p><strong>测试小结</strong><br>在当前的测试机器上, 共有 30g 的存量数据; 根据现有的状况, 在计划 A 中选取的几个测试条件, 分别代表了:</p>
<ul>
<li>5%: 占用较少的 jvm 堆内存资源;</li>
<li>10%: 比较充分得使用 jvm 堆内存资源;</li>
<li>20%: 比较拥挤得争用 jvm 堆内存资源;</li>
<li>30%: 十分拥挤得争用 jvm 堆内存资源;</li>
</ul>
<p>当然, 根据不同机器上的不同数据分布情况, 相应的测试条件也需要调整;<br>从以上测试结果中可以得知: 当各分片 bdb 实例的 in-heap 大小控制在比较高的水平 (20%) 时, 由于数据的 overflow, 将会对整体请求的稳定性造成影响, 产生比较大的乖离率, timeout/error 概率也相应增大; 而当 in-heap 大小控制到更高水平 (30%) 时, 甚至在 250 并发强度下无法正常提供服务, 发生大量 timeout 以及 connection error;<br>综合来说, 这里建议比较充分得使用 jvm 堆内存, 对应测试中的第二项条件 10%;</p>
<h3 id="计划-B-off-heap-缓存大小控制"><a href="#计划-B-off-heap-缓存大小控制" class="headerlink" title="计划 B: off-heap 缓存大小控制"></a><strong>计划 B: off-heap 缓存大小控制</strong></h3><p>测试环境:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-Xms=25g</span><br><span class="line">-Xmx=25g</span><br><span class="line">-Xmn=10g</span><br><span class="line">-Dje.maxMemoryPercent=10</span><br></pre></td></tr></table></figure></p>
<p><strong>B-1: 测试 set</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">    ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_set?keyRange=9999999&amp;valueSize=5000"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/B-1_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ je.maxMemoryPercent</th>
<th style="text-align:center">5%</th>
<th style="text-align:center">10%</th>
<th style="text-align:center">20%</th>
<th style="text-align:center">30%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/122/339/3173</td>
<td style="text-align:center">7/117/318/1714</td>
<td style="text-align:center">6/128/352/1708</td>
<td style="text-align:center">6/131/153/3074</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">85/73</td>
<td style="text-align:center">83/72</td>
<td style="text-align:center">87/75</td>
<td style="text-align:center">89/76</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">71.6</td>
<td style="text-align:center">69.0</td>
<td style="text-align:center">78.0</td>
<td style="text-align:center">75.3</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">14/4.398</td>
<td style="text-align:center">15/5.051</td>
<td style="text-align:center">14/4.397</td>
<td style="text-align:center">15/4.954</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">1/4.243</td>
<td style="text-align:center">0/0</td>
</tr>
</tbody>
</table>
</div>
<p><strong>B-2: 测试 get</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_get?keyRange=9999999"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/B-2_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ je.maxMemoryPercent</th>
<th style="text-align:center">5%</th>
<th style="text-align:center">10%</th>
<th style="text-align:center">20%</th>
<th style="text-align:center">30%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">9/25/29/1030</td>
<td style="text-align:center">8/25/28/1225</td>
<td style="text-align:center">8/26/29/1038</td>
<td style="text-align:center">823/28/29/441</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">23/22</td>
<td style="text-align:center">23/22</td>
<td style="text-align:center">23/24</td>
<td style="text-align:center">23/26</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">11</td>
<td style="text-align:center">5</td>
<td style="text-align:center">2</td>
<td style="text-align:center">371</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">22.5</td>
<td style="text-align:center">25.8</td>
<td style="text-align:center">17.8</td>
<td style="text-align:center">11.6</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">8/1.222</td>
<td style="text-align:center">7/1.214</td>
<td style="text-align:center">6/0.963</td>
<td style="text-align:center">8/1.602</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
</tr>
</tbody>
</table>
</div>
<p><strong>B-3: 测试 mget</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_mget?keyRange=9999999&amp;keyNum=20"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/B-3_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ je.maxMemoryPercent</th>
<th style="text-align:center">5%</th>
<th style="text-align:center">10%</th>
<th style="text-align:center">20%</th>
<th style="text-align:center">30%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/28/162/1029</td>
<td style="text-align:center">6/27/145/1342</td>
<td style="text-align:center">6/28/31/4804</td>
<td style="text-align:center">6/27/67/1431</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">26/24</td>
<td style="text-align:center">26/24</td>
<td style="text-align:center">32/25</td>
<td style="text-align:center">26/23</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">9011</td>
<td style="text-align:center">9467</td>
<td style="text-align:center">10907</td>
<td style="text-align:center">10875</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">29.1</td>
<td style="text-align:center">35.5</td>
<td style="text-align:center">29.8</td>
<td style="text-align:center">36.8</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">27/3.758</td>
<td style="text-align:center">26/3.535</td>
<td style="text-align:center">23/22.947</td>
<td style="text-align:center">23/3.05</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">2/0.236</td>
<td style="text-align:center">2/0.236</td>
<td style="text-align:center">2/1.689</td>
<td style="text-align:center">2/0.245</td>
</tr>
</tbody>
</table>
</div>
<p><strong>测试小结</strong><br>berkeley db 使用堆外内存作为堆内存 overflow 后 spill to disk 之间的缓冲区; 计划 B 分别选取了四个差异较大的测试条件; 从测试结果中可以得知:<br>分配相对充分的 off-heap 比例作为 disk 缓冲区是有一定的效果的, 在 get 测试和 mget 测试中, 10g 与 20g 的测试组都在 gc 次数与 gc 时间上比 512m 和 1g 的测试组占有优势; 在乖离率方面, 10g 与 20g 的测试组也较 512m 和 1g 测试组较低, 稳定性更加;<br>综合来说, 这里建议分配相对充分的堆外内存 (10g ~ 20g) 作为 disk buffer;</p>
<h3 id="计划-C-Xmx-Xms-大小控制"><a href="#计划-C-Xmx-Xms-大小控制" class="headerlink" title="计划 C: -Xmx / -Xms 大小控制"></a><strong>计划 C: -Xmx / -Xms 大小控制</strong></h3><p>一般控制 -Xmx 与 -Xms 相同, 同时这里设置 -XX:NewRatio=2;<br>需要注意的是, 在 64 位机器上, 当 jvm 内存超过 32g, 指针压缩 (CompressedOops) 功能将无法生效, 内存使用效率将会降低; 所以无论机器的物理内存有多大, 每个 jvm 实例的 Xmx 都不建议超过 31g;<br>测试环境:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Dje.maxMemoryPercent=10</span><br><span class="line">-XX:MaxDirectMemorySize=10g</span><br><span class="line">-Dje.maxOffHeapMemory=10g</span><br></pre></td></tr></table></figure></p>
<p><strong>C-1: 测试 set</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_set?keyRange=9999999&amp;valueSize=5000"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/C-1_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ je.maxMemoryPercent</th>
<th style="text-align:center">5%</th>
<th style="text-align:center">10%</th>
<th style="text-align:center">20%</th>
<th style="text-align:center">30%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/123/324/3092</td>
<td style="text-align:center">6/123/343/3140</td>
<td style="text-align:center">6/128/352/1708</td>
<td style="text-align:center">6/138/324/3101</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">83/70</td>
<td style="text-align:center">86/74</td>
<td style="text-align:center">87/75</td>
<td style="text-align:center">94/80</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">26</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">69.0</td>
<td style="text-align:center">76.1</td>
<td style="text-align:center">72.0</td>
<td style="text-align:center">82.3</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">38/4.035</td>
<td style="text-align:center">19/11.268</td>
<td style="text-align:center">6/0.963</td>
<td style="text-align:center">12/6.99</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">2/0.202</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
</tr>
</tbody>
</table>
</div>
<p><strong>C-2: 测试 get</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_get?keyRange=9999999"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/C-2_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ je.maxMemoryPercent</th>
<th style="text-align:center">5%</th>
<th style="text-align:center">10%</th>
<th style="text-align:center">20%</th>
<th style="text-align:center">30%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">9/25/28/2819</td>
<td style="text-align:center">8/25/28/1077</td>
<td style="text-align:center">8/26/29/1038</td>
<td style="text-align:center">10/25/28/1429</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">22/22</td>
<td style="text-align:center">22/22</td>
<td style="text-align:center">23/24</td>
<td style="text-align:center">22/22</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">368</td>
<td style="text-align:center">539</td>
<td style="text-align:center">112</td>
<td style="text-align:center">86</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">45.1</td>
<td style="text-align:center">17.7</td>
<td style="text-align:center">17.8</td>
<td style="text-align:center">18.8</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">17/1.912</td>
<td style="text-align:center">12/1.154</td>
<td style="text-align:center">14/4.397</td>
<td style="text-align:center">5/1.206</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">1/1.934</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
</tr>
</tbody>
</table>
</div>
<p><strong>C-3: 测试 mget</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_mget?keyRange=9999999&amp;keyNum=20"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/C-3_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ je.maxMemoryPercent</th>
<th style="text-align:center">5%</th>
<th style="text-align:center">10%</th>
<th style="text-align:center">20%</th>
<th style="text-align:center">30%</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/28/102/1195</td>
<td style="text-align:center">6/29/140/1264</td>
<td style="text-align:center">6/28/31/4804</td>
<td style="text-align:center">6/28/159/1344</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">27/25</td>
<td style="text-align:center">27/25</td>
<td style="text-align:center">32/25</td>
<td style="text-align:center">28/25</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">6125</td>
<td style="text-align:center">9410</td>
<td style="text-align:center">1090</td>
<td style="text-align:center">7670</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">28.8</td>
<td style="text-align:center">28.7</td>
<td style="text-align:center">29.8</td>
<td style="text-align:center">38.1</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">66/4.818</td>
<td style="text-align:center">32/3.579</td>
<td style="text-align:center">23/22.947</td>
<td style="text-align:center">20/5.442</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">4/0.197</td>
<td style="text-align:center">2/0.202</td>
<td style="text-align:center">2/1.689</td>
<td style="text-align:center">2/0.469</td>
</tr>
</tbody>
</table>
</div>
<p><strong>测试小结</strong><br>此次升级 bdb 版本的重要目的就是使用堆外内存, 降低堆内存, 从而降低 gc 的压力; 在计划 C 中选取了不同的 Xmx, 从测试结果中可以得知:<br>较高的堆内存 (30g) 虽然没有明显的 gc 压力, 但是在乖离率, max rt 等方面相比中等内存 (20g, 25g) 有增加; 另外, 较低的堆内存 (10g) 由于可用内存太少, 可以看出存在频繁的 gc, 无论是 young gc 还是 old gc, 都明显高于其他测试组;<br>综合来说, 这里建议分配适当的堆内存空间 (20g ~ 25g) 作为 Xmx;</p>
<h3 id="计划-D-bdb-版本对比"><a href="#计划-D-bdb-版本对比" class="headerlink" title="计划 D: bdb 版本对比"></a><strong>计划 D: bdb 版本对比</strong></h3><p>选取对比的两个目标版本为: 6.4.25 vs 7.4.5;<br>测试环境:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-Xms=25g</span><br><span class="line">-Xmx=25g</span><br><span class="line">-Xmn=10g</span><br><span class="line">-Dje.maxMemoryPercent=10</span><br><span class="line">-XX:MaxDirectMemorySize=30g</span><br><span class="line">-Dje.maxOffHeapMemory=10g</span><br></pre></td></tr></table></figure></p>
<p><strong>注意: 当 bdb 版本降为 6.4.25 时, 其性能已支撑不了前面三个测试计划中的 250 并发量, 频繁超时, 无法收集到有效数据; 经过多次调节, 确定将并发数降低到 50 方可收集到有效数据;</strong></p>
<p><strong>D-1: 测试 set</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 50 万次请求, 50 个并发</span></span><br><span class="line">ab -n 1000000 -c 50 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_set?keyRange=9999999&amp;valueSize=5000"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/D-1_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ version</th>
<th style="text-align:center">6.4.25</th>
<th style="text-align:center">7.4.5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/24/40/755</td>
<td style="text-align:center">6/24/40/1015</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">17/15</td>
<td style="text-align:center">17/15</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">13.5</td>
<td style="text-align:center">13.4</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">7/2.739</td>
<td style="text-align:center">7/2.621</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
</tr>
</tbody>
</table>
</div>
<p><strong>D-2: 测试 get</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 50 万次请求, 50 个并发</span></span><br><span class="line">ab -n 500000 -c 50 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_get?keyRange=9999999"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/D-2_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ version</th>
<th style="text-align:center">6.4.25</th>
<th style="text-align:center">7.4.5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/8/8/1077</td>
<td style="text-align:center">6/8/8/1130</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">7/7</td>
<td style="text-align:center">7/7</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">2</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">12.6</td>
<td style="text-align:center">10.9</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">3/0.604</td>
<td style="text-align:center">4/0.849</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
</tr>
</tbody>
</table>
</div>
<p><strong>D-3: 测试 mget</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 50 万次请求, 50 个并发</span></span><br><span class="line">ab -n 500000 -c 50 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_mget?keyRange=9999999&amp;keyNum=20"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/D-3_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ version</th>
<th style="text-align:center">6.4.25</th>
<th style="text-align:center">7.4.5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/8/9/510</td>
<td style="text-align:center">6/8/9/1068</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">8/7</td>
<td style="text-align:center">8/7</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">8</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">9.2</td>
<td style="text-align:center">12.0</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">8/1.561</td>
<td style="text-align:center">8/1.049</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">0/0</td>
</tr>
</tbody>
</table>
</div>
<p><strong>测试小结</strong><br>从测试结果来看, 50 并发量的请求压力下, 6.4.25 与 7.4.5 版本没有存在明显的差距; 但是在更高的并发量下, 6.4.25 版本的 berkeley db 根本扛不住;<br>所以这里毫无疑问, 7.4.5 版本的 berkeley db 是优于 6.4.25 版本的;</p>
<h3 id="计划-E-收集器对比"><a href="#计划-E-收集器对比" class="headerlink" title="计划 E: 收集器对比"></a><strong>计划 E: 收集器对比</strong></h3><p>最后是关于收集器的对比; 考虑到 G1 对于大内存 (大于 16g) 的延时管理较其他收集器有优势, 这里也需要就收集器作一些对比测试;<br>两个收集器的选项对比如下:<br>ParNew + CMS:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-XX:ParallelGCThreads=<span class="variable">$&#123;CPU_COUNT&#125;</span></span><br><span class="line"></span><br><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line">-XX:+UseCMSCompactAtFullCollection</span><br><span class="line">-XX:+CMSClassUnloadingEnabled</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=80</span><br><span class="line">-XX:+UseCMSInitiatingOccupancyOnly</span><br><span class="line">-XX:+CMSScavengeBeforeRemark</span><br></pre></td></tr></table></figure></p>
<p>G1:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UnlockDiagnosticVMOptions</span><br><span class="line">-XX:+UseG1GC</span><br><span class="line">-XX:+G1SummarizeConcMark</span><br></pre></td></tr></table></figure></p>
<p>测试环境:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-Xms=25g</span><br><span class="line">-Xmx=25g</span><br><span class="line">-Xmn=10g</span><br><span class="line">-Dje.maxMemoryPercent=10</span><br><span class="line">-XX:MaxDirectMemorySize=30g</span><br><span class="line">-Dje.maxOffHeapMemory=10g</span><br></pre></td></tr></table></figure></p>
<p><strong>E-1: 测试 set</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_set?keyRange=9999999&amp;valueSize=5000"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/E-1_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ collector</th>
<th style="text-align:center">CMS</th>
<th style="text-align:center">G1</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/128/352/1708</td>
<td style="text-align:center">ab timeout</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">87/75</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">0</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">72.0</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">14/4.397</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">/</td>
</tr>
</tbody>
</table>
</div>
<p><strong>E-2: 测试 get</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_get?keyRange=9999999"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/E-2_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ collector</th>
<th style="text-align:center">CMS</th>
<th style="text-align:center">G1</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">8/26/29/1038</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">23/24</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">2</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">17.8</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">6/0.963</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">0/0</td>
<td style="text-align:center">/</td>
</tr>
</tbody>
</table>
</div>
<p><strong>E-3: 测试 mget</strong><br>测试命令:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100 万次请求, 250 个并发</span></span><br><span class="line">ab -n 1000000 -c 250 -s 5 <span class="string">"http://<span class="variable">$&#123;remote_url&#125;</span>/random_mget?keyRange=9999999&amp;keyNum=20"</span></span><br><span class="line">sudo -u www jstat -gcutil -h 10 <span class="variable">$&#123;vmid&#125;</span> 1000 | tee /tmp/jstat_collect/E-3_X</span><br></pre></td></tr></table></figure></p>
<p>测试结果:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">metrics \ collector</th>
<th style="text-align:center">CMS</th>
<th style="text-align:center">G1</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RT (min/P90/P99/max) (ms)</td>
<td style="text-align:center">6/28/31/4804</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">RT (mean/median) (ms)</td>
<td style="text-align:center">32/25</td>
<td style="text-align:center">8/7</td>
</tr>
<tr>
<td style="text-align:center">error/timeout</td>
<td style="text-align:center">10907</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">stdev/bias</td>
<td style="text-align:center">29.8</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">YGC/YGCT (s)</td>
<td style="text-align:center">23/22.947</td>
<td style="text-align:center">/</td>
</tr>
<tr>
<td style="text-align:center">FGC/FGCT (s)</td>
<td style="text-align:center">2/1.689</td>
<td style="text-align:center">/</td>
</tr>
</tbody>
</table>
</div>
<p><strong>测试小结</strong><br>可惜了, 我 retry 了几次, 使用 G1 gc, ab 都在途中 timeout 了; jstat 显示 G1 的 young gc 经历了一个非常长的时间:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT  </span><br><span class="line">0.00 100.00  94.87  47.44  98.45  96.54     12    6.923     0    0.000    6.923</span><br><span class="line">0.00 100.00  94.87  47.44  98.45  96.54     12    6.923     0    0.000    6.923</span><br><span class="line">0.00 100.00   2.89  50.92  98.46  96.54     12   14.315     0    0.000   14.315</span><br><span class="line">0.00 100.00   2.97  50.92  98.46  96.54     12   14.315     0    0.000   14.315</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT  </span><br><span class="line">0.00 100.00  94.87  50.92  98.46  96.54     13   14.315     0    0.000   14.315</span><br><span class="line">0.00 100.00  94.87  50.92  98.46  96.54     13   14.315     0    0.000   14.315</span><br><span class="line">0.00 100.00   2.14  55.58  98.29  96.54     13   25.692     0    0.000   25.692</span><br><span class="line">0.00 100.00   2.21  55.58  98.29  96.54     13   25.692     0    0.000   25.692</span><br></pre></td></tr></table></figure>
<p>我对 G1 的了解还是不够深入, 可能当前的场景比较特殊, 需要作定制化的调参, 之前使用 G1 都是只加 <code>-XX:+UseG1GC</code> 和 <code>-XX:+G1SummarizeConcMark</code> 两个参数, 其余的优化都交给 jvm 了, 然而对于今天的场景这可能不够用了, 这个需要另行研究了;</p>
<h2 id="测试总结"><a href="#测试总结" class="headerlink" title="测试总结"></a><strong>测试总结</strong></h2><p>本次测试采用 ab + jstat 组合的方式同时采集测试数据, ab 用于反映系统表面的性能指标, jstat 用于反映系统的 gc 状态, 并进而反映隐藏在表面之下的系统性能问题或者服务潜力;<br>本次测试并没有作极限测量 (不断增大并发直至压挂为止), 而是根据当前的调用状况取了一个留有适当 buffer 的并发量, 从测试结果中可以间接得计算当前服务能承载的 TPS;<br>根据测试的结果, 7.4.5 版本的 berkeley db 优于 6.4.25 版本的 berkeley db, 其在并发承受能力上存在明显优势;<br>在收集器选择上, 暂时还是使用 CMS 比较稳妥, G1 可能遇到了特殊的情况, 需要后续研究调优的方法;<br>在使用 7.4.5 版本的 berkeley db 时, 建议作如下内存配置组合, 以达到较好的使用效果:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-Xms= 20g ~ 30g</span><br><span class="line">-Xmx= 20g ~ 30g</span><br><span class="line"></span><br><span class="line">-Dje.maxMemoryPercent= <span class="variable">$&#123;Xmx&#125;</span> * 80% / <span class="variable">$&#123;bdb_shard_number&#125;</span></span><br><span class="line">-XX:MaxDirectMemorySize= (<span class="variable">$&#123;machine_total_memory&#125;</span> - <span class="variable">$&#123;Xmx&#125;</span>) * 80%</span><br><span class="line">-Dje.maxOffHeapMemory= <span class="variable">$&#123;MaxDirectMemorySize&#125;</span> / <span class="variable">$&#123;bdb_shard_number&#125;</span></span><br></pre></td></tr></table></figure></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        

        
        <strong>本文链接:</strong> <a href="/2018/08/12/linux-other--berkeley_db7.x压力测试报告/" rel="external">http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告</a> <br/> 感谢您的阅读与支持！
        
    </div>
    
    <footer>
        <a href="http://zshell.cc">
            <img src="https://avatars0.githubusercontent.com/u/8027247?s=460&v=4" alt="zshellzhang">
            zshellzhang
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jvm-gc/">jvm:gc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux-other/">linux:other</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux-perf/">linux:perf</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/&title=《berkeley db 7.x 压力测试报告》 — 希尔的博客&pic=https://avatars0.githubusercontent.com/u/8027247?s=460&v=4" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/&title=《berkeley db 7.x 压力测试报告》 — 希尔的博客&source=
之前写过一篇文章 apache benchmark 使用笔记, 介绍了 apache benchmark 的使用及注意事项, 当时我确实是使用 ab 作..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《berkeley db 7.x 压力测试报告》 — 希尔的博客&url=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/&via=http://zshell.cc" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/08/26/life-pc--linux重度使用者拿到MacBook后的一系列挣扎/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">linux 重度使用者拿到 MacBook 后的一系列挣扎</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/08/03/jdk--ThreadLocal相关知识全梳理/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">ThreadLocal 相关知识全梳理</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "fMh2JHgkPnDtARiQapOg8Jrk-gzGzoHsz",
            appKey: "UPNXLDUkngDnuhfC9XQPgF6n",
            avatar: "mm",
            placeholder: "您的评论, 吾愿洗耳恭听!",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        感谢支持!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>zshellzhang &copy; 2016 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/&title=《berkeley db 7.x 压力测试报告》 — 希尔的博客&pic=https://avatars0.githubusercontent.com/u/8027247?s=460&v=4" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/&title=《berkeley db 7.x 压力测试报告》 — 希尔的博客&source=
之前写过一篇文章 apache benchmark 使用笔记, 介绍了 apache benchmark 的使用及注意事项, 当时我确实是使用 ab 作..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《berkeley db 7.x 压力测试报告》 — 希尔的博客&url=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/&via=http://zshell.cc" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://zshell.cc/2018/08/12/linux-other--berkeley_db7.x压力测试报告/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACu0lEQVR42u3awW7bMBAE0Pz/T7dAz5Y8syvaKfB0ClSb4WMALjvcn5/4+fPvyd8kn0++lYzwwIOHh4c3mvrVc/WZfAmuRrufSbIQ93PGw8PDO83Lh7vf0JPykJeQfOTL93h4eHhf5d1v3/fvkwIzW1A8PDy8/4s3W4JZuICHh4f323hJGDGLHmYRbb58j2UteHh4eDFvsyl/6+eD93t4eHh4i1v1/NKrDSDy4pGP82JkPDw8vAO8/QX/JrrND+5JSSj+x4CHh4e34LXbd0Jqy8k+dLhcXDw8PLwDvFlEOwtb86NzGxZHR2o8PDy8R3n5dJPyMAuI2zaFdvnw8PDwnuK1X2vDiDySmBWSugzg4eHhrXmzGpKEBbOQIl/0GoyHh4d3jNfCNpt+Pv6saOHh4eGd4OXTut/E839teXlrwk9y9sfDw8Nb8/Itu23Dylum9ofsNzPEw8PDO8zbNw3kyDYszqkvOiPw8PDwHuXlW/+sPLRxRnvFVZQiPDw8vAO8fWNBe0zfhyNFTxkeHh7eR3gnLsBm5eGp+AMPDw9vw0s23GI94gVq44/7b10uGR4eHt4x3uy6q70Y21+21Ud5PDw8vAO8zXG5xWwKT16c8PDw8D7Py2OCPDZtj+abclIPioeHhzfibaLV5JlFw5vWhMueMjw8PLw1L7mUypsJ2qN5Esu25QEPDw/vk7x8C94crFt225JV/DXw8PDwRrzNJJKGgFm3V5ujFL8FDw8Pb82bxQr7RoFZapLMBw8PD+80b7b5zmpOG2TkMcfsmg0PDw9vw9sfiGfFY3/xVrcO4OHh4T3KmwUT7TV/Mk4b0b75PB4eHt5XeUmMu1mOWYvVm9+Ch4eH9wt4bZibH+jzqLc4+uPh4eEd4+VhxCa8aItEWx5evMHDw8M7wHu2b6t9/1RT1+rBw8PDS3l/AYDrDQHdxtirAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>








<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!--<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>
</html>
